# Экспериментальная библиотека для модели черно-белого графа
Данный репозиторий содержит реализацию модели черно-белого графа (Black-White Graph). Черно-белый граф -- это GLM оболочка над моделями-экспертами любого вида.

<span style="color: green;">На текущий момент в модели реализована:</span>
- Поддержка мультипликативных зависимостей между ядрами ($\gamma$-параметры);
- Поддержка аддитивных зависимостей между ядрами ($\beta$-параметры);
- Поддержка смещений в пространстве ошибки ($\alpha$-параметры).

<span style="color: red;">Требует исследования и дальнейшей реализации:</span>
- Поддержка нелинейности в черных вершинах (оболочки Sigm, Tanh, ReLU, ELU и т.д);
- Масштабирования ядровых функций степенного вида (внедрение $\phi$-параметров)

<span style="color: yellow;">Технические аспекты развития:</span>
- Оптимизация вычислений градиентов;
- Оптимизация расчета метрик;
- Векторизация некоторых циклов.

## Содержание
- [Структура проекта](#структура-проекта)
- [Пример использования модели](#пример-использования-модели)
  - [1. Инициализация модели графа](#1-инициализация-модели-графа)
  - [2. Загрузка и подготовка данных](#2-загрузка-и-подготовка-данных)
  - [3. Настройка (обучение) модели](#3-настройка-обучение-модели)
- [Спецификация основных методов](#спецификация-основных-методов)
- [Описание структуры модели](#описание-структуры-модели)

## Структура проекта 

```
MyGraphLib
│
├───+BWGraph                            # Пространство имен модели черно-белого графа
│   │   Edge.m                           # Класс, описывающие рёбра графа
│   │   GraphShell.m                     # Класс-оболочка графа
│   │   Node.m                            # Класс, описывающий вершины графа
│   │   NodeColor.m                      # Перечисление для определения типа вершины (черная / белая)
│   │
│   ├───+CustomMatrix                    # Пространство имен для описания матрицы из векторов произвольной длины
│   │       BWMatrix.m                    # Класс, описывающий матрицу и базовые операции
│   │       BWRow.m                       # Класс, описывающий вектор-строку произвольной длины
│   │
│   ├───+RandomGenerator                  # Пространство имен для генераторов первичной инициализации параметров рёбер
│   │       AlphaGenerator.m               # Пример класса для инициализации параметров альфа
│   │       BetaGenerator.m                # Пример класса для инициализации параметров бета
│   │       IRandomGen.m                   # Интерфейс, имплементация которого обязательна для всех будущих генераторов
│   │
│   └───+Trainer                           # Пространство имен, содержащие оболочку, контролирующую настройку модели
│           Trainer.m                       # Класс, контролирующий настройку модели
│
├───+coreFunctions                         # Пространство имен, содержащие пример ядровых функций и интерфейс для них
│       ICoreF.m                            # Интерфейс ядровых функций, имплементация которого обязательна для всех будущих ядровых функций
│       Heating2DModel.m                    # Модель нагрева (используется в примере)
│       LinearFunction.m                     # Пример простой линейной функции ядра
└───   ...
```
## Пример использования модели

В папке `~/Exp/` располагаются примеры экспериментов с моделью на различных данных.

Далее изложены основные аспекты взаимодействия с моделью

### 1. Инициализация модели графа

На первом этапе создается структура графа. 
	Черные вершины (`Black`) содержат ядровые функции, для которых отсутствуют в явном виде эталонные наблюдения. 
	Белые вершины (`White`) содержат эталонные наблюдения.
	
В основе белой вершины обязательно должна находится ядровая функция, которая обязана быть классом, реализующим интерфейс `ICoreF`. Все ядровые функции располагаются в пространстве имен `BWMGraph.coreFunctions.*`.

```matlab
% Импорт пространств имен
import BWGraph.*;
import BWGraph.CustomMatrix.*;
import BWGraph.RandomGenerator.*;
import BWGraph.Trainer.*;

% Создание ядровой функции для модели. Ядровые функции должны быть частью пространства имен coreFunctions
HeatBC_1 = coreFunctions.Heating2DModel(30, 21, 21, 50, 1.5e-5, 0.3, 0.360, 30, 10);
HeatBC_2 = coreFunctions.Heating2DModel(60, 21, 21, 60, 1.5e-5, 0.3, 0.360, 500, 10);
HeatBC_3 = coreFunctions.Heating2DModel(90, 21, 21, 70, 1.5e-5, 0.3, 0.360, 1000, 10);
```

Генераторы начальных весов для параметров располагаются в пространстве имен `BWGraph.RandomGenerator.*`.  Все генераторы должны быть классами, реализующими интерфейс `IRandomGen`

```matlab
% Генераторы начальных весов для ребер
alfaGen = FullRandomAlfaGen(1,1e2);
betaGen = FullRandomBetaGen(1,1e3);
```

Вершины графовой модели определяются, как отдельные объекты `Node`:

```matlab
% Создание вершин графа
nodeA = Node(1, 30,'Black',HeatBC_1);
nodeB = Node(2, 30,'Black',HeatBC_2);
nodeC = Node(3, 30,'Black',HeatBC_1); 
nodeE = Node(5, 30,'White',HeatBC_3); % Белая вершина (выход модели)

% Определение связей
nodeA.addEdge(nodeB);
nodeB.addEdge(nodeA);
nodeB.addEdge(nodeE);
nodeE.addEdge(nodeB);
nodeC.addEdge(nodeA);
nodeC.addEdge(nodeB);
```

Формирование единой модели происходит путем создания оболочки графа `GraphShell`:

```matlab
% Создание графовой модели
modelShell = GraphShell(alfaGen, betaGen, nodeA, nodeB, nodeC, nodeE);
```

### 2. Загрузка и подготовка данных

Для работы с моделью необходимо преобразовать загруженные данные в формат `BWMatrix`

Каждый образец (`BWMatrix`) представляет собой Jagged-массив, расположенный в пространстве имен `BWGraph.CustomMatrix.*`

```matlab
% Загружаем данные (для примера взят Excel)
data = readtable("SomeData.xlsx");

% Получить количество вершин в созданной модели графа
numOfWhiteNodes = modelShell.GetNumOfWhiteNode;

% Определяем количество данных в исходном массиве
numSamples = height(data);

% Инициализация массивов BWMatrix
XData = repmat(BWMatrix(), numSamples, 1);
YData = repmat(BWMatrix(), numSamples, 1);
```

Каждый объект `BWMatrix` внутри содержит произвольное количество объектов `BWRow`, которые сами по себе содержат некоторую `Data`, определенную для входа конкретной вершины. 

Для представленной выше модели на основе ядровых функций нестационарной теплопроводности, формирование входов будет выполняться следующим образом:

```matlab
% Пример форматирования входных данных.
for i = 1:numSamples
    % Собираем Data по входам вершин
    inputParams_for_v1 = [timeValues_for_v1(i); TinfValues_for_v1(i)];
    inputParams_for_v2 = [timeValues_for_v2(i); TinfValues_for_v2(i)];
    inputParams_for_v3 = [timeValues_for_v3(i); TinfValues_for_v3(i)];

    % Включаем их в BWMatrix через создание BWRow-объекта
    XData(i) = XData(i).addRow(inputParams_for_v1);
    XData(i) = XData(i).addRow(inputParams_for_v2);
    XData(i) = XData(i).addRow(inputParams_for_v3);
end
```

Ожидаемые эталонные наблюдения формируются аналогичным образом, где индекс объекта `BWRow` внутри `BWMatrix` отвечает за индекс белой вершины по её порядку.

**Загрузка требует точного следования архитектуре модели**

```matlab
for i = 1:numSamples
    % Собираем Data по выходам вершин
    yMatrix(1) = resValue(i);
    % Включаем их в BWMatrix через создание BWRow-объекта
    YData(i) = YData(i).addRow(yMatrix);
end
```

Для того, чтобы отрисовать граф и пронаблюдать модель необходимо вызвать встроенную функцию в `GraphShell`:

```matlab
modelShell.DrawGraph_New('Модель нагрева');
```

### 3. Настройка (обучение) модели

Настройка модели выполняется при помощи модуля `Trainer`, расположенного в пространстве имен `BWMGraph.Trainer.*`

Установка гиперпараметров настройки происходит при помощи создания объекта `TrainingOptions` из пространства имен `BWMGraph.Trainer.*`

```matlab
% Опции настройки
trainerOptions = TrainingOptions("LearningRate", 0.01, ...
	"Beta1", 0.9, ...
	"Beta2", 0.999, ...
	"Eps", 1e-8, ...
	"NodeSize", [1.3, 1.3, 1.3, 1.3, 1.3], ...
	"NodeWeight", [1,1,1,1,1], ...
	"Epoches", 500, ...
	"ClipUp", 1e15, ...
	"ClipDown", -1e15, ...
	"TargetError", 10, ...
	"Lambda_Agg", 1, ...
	"Lambda_Alph", 0.3, ...
	"Lambda_Beta", 0.3, ...
	"Lambda_Gamma",0.3, ...
	"ErrorMetric",'mae', ...
	"LossFunction",'mse', ...
	"TargetNodeIndices",[]);
```

Настройщик вызывается следующим образом:

```matlab
trainer = Trainer(modelShell, trainerOptions);
```

В него обязательно передается объект `GraphShell`, который является ссылочным классом и настраивается без необходимости выгружать его из объекта `Trainer`. 

Запуск процесса настройки выполняется вызовом метода `.Train`, который принимает на вход 4 объекта `BWMatrix`:

```matlab
trainer.Train(XDataTrain, YDataTrain, XDataTest, YDataTest);
```

## Спецификация основных методов

Детализация параметров ''среды настройки" `.Trainer`:

```matlab
function obj = Trainer(Graph, TrainingOptions)
```

| Параметр        | Тип                             | Описание                                                         |
| --------------- | ------------------------------- | ---------------------------------------------------------------- |
| Graph           | BWGraph.GraphShell              | Оболочка графа для которой будет происходит настройка параметров |
| TrainingOptions | BWGraph.Trainer.TrainingOptions | Объект с параметрами настройки                                   |
Параметры настройки объекта `TrainingOptions` детализированы далее:

```matlab
trainerOptions = TrainingOptions("LearningRate", 0.01, ...
	"Beta1", 0.9, ...
	"Beta2", 0.999, ...
	"Eps", 1e-8, ...
	"NodeSize", [1.3, 1.3, 1.3, 1.3, 1.3], ...
	"NodeWeight", [1,1,1,1,1], ...
	"Epoches", 500, ...
	"ClipUp", 1e15, ...
	"ClipDown", -1e15, ...
	"TargetError", 10, ...
	"Lambda_Agg", 1, ...
	"Lambda_Alph", 0.3, ...
	"Lambda_Beta", 0.3, ...
	"Lambda_Gamma",0.3, ...
	"ErrorMetric",'mae', ...
	"LossFunction",'mse', ...
	"TargetNodeIndices",[]);function obj = TrainingOptions(options)
```

| Параметр                | Тип            | Описание                                                            |
| ----------------------- | -------------- | ------------------------------------------------------------------- |
| **`LearningRate`**      | `double`       | Начальная скорость обучения. Положительное число > 0.               |
| **`Beta1`**             | `double`       | Коэф. затухания для первого момента (адаптация градиента). > 0.     |
| **`Beta2`**             | `double`       | Коэф. затухания для второго момента (адаптация learning rate). > 0. |
| **`Eps`**               | `double`       | Малое число для численной стабильности. > 0.                        |
| **`NodeWeight`**        | `double (1,:)` | Вектор весов для узлов графа, равный количеству вершин.             |
| **`NodeSize`**          | `double (1,:)` | Вектор размеров для узлов графа, равный количеству вершин.          |
| **`Epoches`**           | `integer`      | Максимальное количество эпох обучения. > 0.                         |
| **`ClipUp`**            | `double`       | Верхняя граница для ограничения градиента.                          |
| **`ClipDown`**          | `double`       | Нижняя граница для ограничения градиента.                           |
| **`TargetError`**       | `double`       | Целевое значение ошибки для остановки обучения. > 0.                |
| **`Lambda_Agg`**        | `double`       | Коэф. регуляризации для агрегирующих функций. >= 0.                 |
| **`Lambda_Alph`**       | `double`       | Коэф. регуляризации для параметра альфа. > 0.                       |
| **`Lambda_Beta`**       | `double`       | Коэф. регуляризации для параметра бета. > 0.                        |
| **`Lambda_Gamma`**      | `double`       | Коэф. регуляризации для параметра гамма. > 0.                       |
| **`ErrorMetric`**       | `string`       | Метрика настройки (`'mae', 'mse', 'rmse', 'mape'`).                 |
| **`LossFunction`**      | `string`       | Функция потерь для обучения (`'mae', 'mse', 'huber', 'logcosh'`).   |
| **`TargetNodeIndices`** | `double[]`     | Индексы белых вершин для расчета ошибки. `[]` = все.                |
Детализация параметров метода настройки `.Train`

```matlab
function Train(obj,XDataTrain, YDataTrain, XDataTest, YDataTest)
```

| Параметр   | Тип                           | Описание                                           |
| ---------- | ----------------------------- | -------------------------------------------------- |
| XDataTrain | BWGraph.CustomMatrix.BWMatrix | Набор входных данных вершин для обучения           |
| YDataTrain | BWGraph.CustomMatrix.BWMatrix | Набор выходных (эталонных) наблюдений для обучения |
| XDataTest  | BWGraph.CustomMatrix.BWMatrix | Набор входных данных для тестирования (валидация)  |
| YDataTest  | BWGraph.CustomMatrix.BWMatrix | Набор выходных данных для тестирования (валидация) |
Детализация метода прямого расчета модели графа `.Forward`:

```matlab
modelShell.Forward(XData)
```

| Параметр | Тип                           | Описание                                                 |
| -------- | ----------------------------- | -------------------------------------------------------- |
| XData    | BWGraph.CustomMatrix.BWMatrix | Набор входов для прямого прогона модели по всем вершинам |
## Описание структуры модели

#### Класс `Node`

Класс `Node` представляет вершину черно-белого графа и содержит методы для управления её состоянием и связями.

| Метод                              | Описание                                                          | Входные параметры                                                                                                                                                                                                  | Выходные параметры                                  |
| ---------------------------------- | ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------- |
| **Node(...)**                      | Конструктор класса. Создает новую вершину с заданными параметрами | `ID` - положительный идентификатор  <br>`initialValue` - начальное значение FResult  <br>`nodeType` - тип вершины (White/Black)  <br>`nodeFunction` - функция вершины (может быть пустой только для черных вершин) | Объект класса Node                                  |
| **getNodeType()**                  | Возвращает тип вершины                                            | Нет                                                                                                                                                                                                                | Тип вершины (`BWGraph.NodeColor`)                   |
| **addEdge(targetNode)**            | Добавляет исходящее ребро из текущей вершины в целевую            | `targetNode` - целевая вершина (`BWGraph.Node`)                                                                                                                                                                    | Нет (void)                                          |
| **removeEdgeByTarget(targetNode)** | Удаляет ребро по целевой вершине                                  | `targetNode` - целевая вершина (`BWGraph.Node`)                                                                                                                                                                    | `success` - логическое значение успеха операции     |
| **getEdgeToTarget(targetNode)**    | Возвращает ребро, ведущее в указанную целевую вершину             | `targetNode` - целевая вершина (`BWGraph.Node`)                                                                                                                                                                    | Объект класса `BWGraph.Edge`                        |
| **getNeighbors()**                 | Возвращает список всех соседних вершин (целей)                    | Нет                                                                                                                                                                                                                | Массив объектов `BWGraph.Node`                      |
| **getOutEdges()**                  | Возвращает все исходящие рёбра вершины                            | Нет                                                                                                                                                                                                                | Массив объектов `BWGraph.Edge`                      |
| **getFResult()**                   | Возвращает текущее значение FResult вершины                       | Нет                                                                                                                                                                                                                | Значение `double`                                   |
| **setFResult(value)**              | Устанавливает новое значение FResult                              | `value` - конечное значение (double)                                                                                                                                                                               | Нет (void)                                          |
| **calcNodeFunc(inputData)**        | Вычисляет функцию вершины с учётом параметра Gamma                | `inputData` - входные данные                                                                                                                                                                                       | Результат вычислений (double)                       |
| **calcRawCoreFunction(inputData)** | Вычисляет "сырую" функцию вершины (без учёта Gamma)               | `inputData` - входные данные                                                                                                                                                                                       | Результат вычислений (double)                       |
| **getOutEdgesMap()**               | Возвращает словарь исходящих рёбер                                | Нет                                                                                                                                                                                                                | Объект `dictionary`                                 |
| **getNodeFunction()**              | Возвращает функцию вершины                                        | Нет                                                                                                                                                                                                                | Объект функции (реализующей `coreFunctions.ICoreF`) |

#### Класс `Edge`

Класс `Edge` представляет ребро графа, соединяющее две вершины и содержащее параметры передачи сигнала.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**Edge(SourceNode, TargetNode, Alfa, Beta, Id)**|Конструктор класса. Создает новое ребро между вершинами|`SourceNode` - исходная вершина  <br>`TargetNode` - целевая вершина  <br>`Alfa` - параметр α (по умолчанию 0)  <br>`Beta` - параметр β (по умолчанию 0)  <br>`Id` - идентификатор ребра|Объект класса Edge|

#### Класс `GraphShell`

Класс `GraphShell` является основным контейнером для графа и предоставляет методы для работы с ним, включая прямой проход и вычисление производных.

| Метод                                                                       | Описание                                                                    | Входные параметры                                                                                                                                | Выходные параметры                               |
| --------------------------------------------------------------------------- | --------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------ |
| **LoadFromFile(filename)**                                                  | Статический метод. Загружает граф из файла                                  | `filename` - имя файла (без расширения .mat)                                                                                                     | Полностью инициализированный объект `GraphShell` |
| **GraphShell(AlphaGenerator, BetaGenerator, varargin)**                     | Конструктор класса. Создает новый граф с заданными генераторами и вершинами | `AlphaGenerator` - генератор для α параметров  <br>`BetaGenerator` - генератор для β параметров  <br>`varargin` - переменное число объектов Node | Объект класса GraphShell                         |
| **Forward(Data)**                                                           | Выполняет прямой проход по графу с использованием матричного подхода        | `Data` - объект `BWGraph.CustomMatrix.BWMatrix`                                                                                                  | Нет (void), обновляет FResult в вершинах         |
| **GetNumOfWhiteNode()**                                                     | Возвращает количество белых вершин                                          | Нет                                                                                                                                              | Количество белых вершин (double)                 |
| **GetNumOfBlackNode()**                                                     | Возвращает количество черных вершин                                         | Нет                                                                                                                                              | Количество черных вершин (double)                |
| **GetWhiteNodes()**                                                         | Возвращает все белые вершины                                                | Нет                                                                                                                                              | Массив белых вершин (`BWGraph.Node`)             |
| **GetBlackNodes()**                                                         | Возвращает все черные вершины                                               | Нет                                                                                                                                              | Массив черных вершин (`BWGraph.Node`)            |
| **GetWhiteNodesIndices()**                                                  | Возвращает индексы всех белых вершин                                        | Нет                                                                                                                                              | Массив индексов (double)                         |
| **GetBlackNodesIndices()**                                                  | Возвращает индексы всех черных вершин                                       | Нет                                                                                                                                              | Массив индексов (double)                         |
| **GetModelResults()**                                                       | Возвращает текущие результаты модели (FResult) для всех вершин              | Нет                                                                                                                                              | Массив значений (double)                         |
| **GetCurrentResult(XData)**                                                 | Выполняет прямой проход и возвращает результаты                             | `XData` - входные данные                                                                                                                         | Массив результатов (double)                      |
| **getIncomingNeighbors(targetNode)**                                        | Возвращает все вершины, имеющие ребра в указанную целевую вершину           | `targetNode` - целевая вершина                                                                                                                   | Массив исходных вершин (`BWGraph.Node`)          |
| **IsWhiteVertice(index)**                                                   | Проверяет, является ли вершина с указанным индексом белой                   | `index` - индекс вершины                                                                                                                         | Логическое значение (true/false)                 |
| **IsBlackVertice(index)**                                                   | Проверяет, является ли вершина с указанным индексом черной                  | `index` - индекс вершины                                                                                                                         | Логическое значение (true/false)                 |
| **buildSystemMatrices(Data)**                                               | Строит матрицы системы для прямого прохода                                  | `Data` - входные данные                                                                                                                          | `[D, A_in, B_in, B_out, L]` - матрицы системы    |
| **computeGammaDerivativeForNode(nodeIndex, inputData)**                     | Вычисляет производную по параметру Gamma для указанной вершины              | `nodeIndex` - индекс вершины  <br>`inputData` - входные данные                                                                                   | Значение производной (double)                    |
| **computeOutgoingAlphaDerivativeForEdge(nodeIndex)**                        | Вычисляет производную по α для исходящего ребра                             | `nodeIndex` - индекс вершины                                                                                                                     | Значение производной (double)                    |
| **computeOutgoingBetaDerivativeForEdge(nodeIndex)**                         | Вычисляет производную по β для исходящего ребра                             | `nodeIndex` - индекс вершины                                                                                                                     | Значение производной (double)                    |
| **computeAllDerivativesInOrder(XData)**                                     | Вычисляет все производные в топологическом порядке                          | `XData` - входные данные                                                                                                                         | Три Map-объекта с производными по α, β и γ       |
| **computeOutgoingAlphaDerivativeDirect(nodeIndex)**                         | Прямое вычисление ∂F_v/∂α для исходящего ребра                              | `nodeIndex` - индекс вершины                                                                                                                     | Значение производной (double)                    |
| **computeOutgoingBetaDerivativeDirect(nodeIndex)**                          | Прямое вычисление ∂F_v/∂β для исходящего ребра                              | `nodeIndex` - индекс вершины                                                                                                                     | Значение производной (double)                    |
| **computeIncomingAlphaDerivativeDirect(nodeIndex, edge, dF_source_dalpha)** | Вычисление ∂F_v/∂α для входящего ребра                                      | `nodeIndex` - индекс вершины  <br>`edge` - ребро  <br>`dF_source_dalpha` - производная исходной вершины                                          | Значение производной (double)                    |
| **computeIncomingBetaDerivativeDirect(nodeIndex, edge, dF_source_dbeta)**   | Вычисление ∂F_v/∂β для входящего ребра                                      | `nodeIndex` - индекс вершины  <br>`edge` - ребро  <br>`dF_source_dbeta` - производная исходной вершины                                           | Значение производной (double)                    |
| **DrawGraph_New(titleStr)**                                                 | Визуализирует структуру графа с параметрами на рёбрах                       | `titleStr` - заголовок графика (опционально)                                                                                                     | Нет (создает фигуру с графом)                    |
| **getIncomingEdges(targetNode)**                                            | Возвращает все входящие ребра для указанной вершины                         | `targetNode` - целевая вершина                                                                                                                   | Массив входящих рёбер (`BWGraph.Edge`)           |

#### Класс `Trainer`

Класс `Trainer` реализует алгоритмы обучения графовой модели с использованием градиентных методов и оптимизации ADAM.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**Trainer(Graph, TrainingOptions)**|Конструктор класса. Создает объект тренера для указанного графа|`Graph` - объект `BWGraph.GraphShell`  <br>`TrainingOptions` - объект `BWGraph.Trainer.TrainingOptions`|Объект класса Trainer|
|**Train(XDataTrain, YDataTrain, XDataTest, YDataTest)**|Основной метод обучения. Выполняет настройку параметров графа|`XDataTrain` - входные данные для обучения  <br>`YDataTrain` - целевые выходы для обучения  <br>`XDataTest` - входные данные для тестирования  <br>`YDataTest` - целевые выходы для тестирования|Нет (выполняет обучение, обновляет параметры графа, выводит графики)|
|**GetGraph()**|Возвращает текущий граф|Нет|Объект `BWGraph.GraphShell`|

#### Класс `TrainingOptions`

Класс `TrainingOptions` содержит все настраиваемые параметры процесса обучения графовой модели.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**TrainingOptions(options)**|Конструктор класса. Создает объект с параметрами обучения|`options` - структура с именованными параметрами (опционально)|Объект класса TrainingOptions|
|**toStruct()**|Преобразует объект в структуру|Нет|Структура со всеми свойствами объекта|
##### Основные свойства класса `TrainingOptions`:

|Свойство|Описание|Значение по умолчанию|
|---|---|---|
|`LearningRate`|Шаг обучения|0.001|
|`Beta1`, `Beta2`|Параметры ADAM оптимизатора|0.9, 0.999|
|`Eps`|Малое число для численной стабильности|1e-8|
|`NodeWeight`|Веса вершин при обучении|[]|
|`NodeSize`|Размеры вершин (влияют на шаг обучения)|[]|
|`BatchSize`|Размер батча|1|
|`Epoches`|Количество эпох обучения|100|
|`TargetError`|Целевая ошибка для остановки обучения|1e-5|
|`ClipUp`, `ClipDown`|Границы обрезки градиентов|1e5, -1e5|
|`Lambda_Alph`, `Lambda_Beta`, `Lambda_Gamma`|Коэффициенты регуляризации|0.01|
|`Lambda_Agg`|Коэффициент агрегации ошибки|0|
|`HuberDelta`|Параметр δ для Huber Loss|1|
|`TargetNodeIndices`|Индексы целевых вершин для анализа|[] (все белые)|
|`ErrorMetric`|Метрика ошибки (`mae`, `mse`, `rmse`, `mape`)|"mae"|
|`LossFunction`|Функция потерь (`mae`, `mse`, `huber`, `logcosh`)|"mae"|

#### Класс `IRandomGen` (Интерфейс)

Это абстрактный интерфейсный класс, который должны реализовывать все генераторы случайных параметров для графа. Он определяет контракт на генерацию и сериализацию.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**Generate(obj, vararg)**|Абстрактный метод. Генерирует случайные значения и присваивает их элементам графа.|`vararg` - переменное число аргументов (обычно объект графа)|Нет (void)|
|**save(obj)**|Абстрактный метод. Сериализует состояние генератора в структуру для сохранения в файл.|Нет|`data` - структура с данными генератора|
|**load(obj, data)**|Абстрактный метод. Восстанавливает состояние генератора из структуры.|`data` - структура с данными, загруженная из файла|Нет (void)|
|**createFromData(data)**|Абстрактный статический метод. Фабричный метод для создания экземпляра конкретного генератора из загруженных данных.|`data` - структура с данными|`obj` - экземпляр класса-генератора|

##### Класс `FullRandomGen`

Конкретная реализация генератора случайных параметров. Наследуется от интерфейса `IRandomGen`. Заполняет параметры (`Alfa`, `Beta`) всех рёбер графа случайными значениями из заданного диапазона.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**FullRandomGen(minVal, maxVal, type)**|Конструктор класса. Создает генератор для указанного типа параметра и диапазона.|`minVal` - минимальное значение  <br>`maxVal` - максимальное значение  <br>`type` - тип параметра ('Alfa', 'Beta', 'Gamma', 'Delta')|Объект класса `FullRandomGen`|
|**Generate(obj, graphshell)**|Реализация метода интерфейса. Проходит по всем рёбрам графа и присваивает параметру указанного типа случайное значение в заданном диапазоне.|`graphshell` - объект графа (`BWGraph.NonLinearBWGraph.GraphShellNonlinear`)|Нет (void)|
|**save(obj)**|Реализация метода интерфейса. Сохраняет состояние генератора.|Нет|`data` - структура с полями `ClassName`, `MinValue`, `MaxValue`|
|**load(obj, data)**|Реализация метода интерфейса. Восстанавливает состояние генератора.|`data` - структура с данными|Нет (void)|
|**createFromData(data)**|Реализация статического фабричного метода. Создает экземпляр `FullRandomGen` из загруженных данных. **Важно:** В текущей реализации метод ошибочно пытается создать `BetaGenerator`. Это следует исправить на вызов конструктора `FullRandomGen`.|`data` - структура с данными|Объект класса `FullRandomGen`|

#### Класс `ICoreF` (Интерфейс)

Абстрактный интерфейсный класс для функций, которые могут быть ассоциированы с вершинами (`NodeFunction`). Определяет контракт для вычисления функции и сериализации.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**CalcCoreFunction(obj, InputParams)**|Абстрактный метод. Вычисляет значение функции на основе входных данных.|`InputParams` - входные параметры|`result` - результат вычислений|
|**GetNumOfInputParams(obj)**|Абстрактный метод. Возвращает ожидаемое количество входных параметров для функции.|Нет|Количество параметров (double)|
|**save(obj)**|Абстрактный метод. Сериализует состояние функции в структуру.|Нет|`data` - структура с данными|
|**load(obj, data)**|Абстрактный метод. Восстанавливает состояние функции из структуры.|`data` - структура с данными|Нет (void)|
|**createFromData(data)**|Абстрактный статический метод. Фабричный метод для создания экземпляра конкретной функции из загруженных данных.|`data` - структура с данными|Объект класса, реализующего `ICoreF`|
#### Класс `BWRow`

Простой класс-контейнер для хранения строки данных в кастомной матрице `BWMatrix`.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**BWRow(data)**|Конструктор класса. Создает строку с указанными данными.|`data` - массив данных для строки|Объект класса `BWRow`|
#### Класс `BWMatrix`

Класс для хранения и работы с данными в формате "рваной" матрицы (матрицы, строки которой могут иметь разную длину). Используется для передачи входных (`XData`) и выходных (`YData`) данных в модель.

|Метод|Описание|Входные параметры|Выходные параметры|
|---|---|---|---|
|**BWMatrix(varargin)**|Конструктор класса. Может принимать переменное число объектов `BWRow` или один cell-массив, содержащий данные для строк.|`varargin` - объекты `BWRow` или cell-массив|Объект класса `BWMatrix`|
|**addRow(obj, rowData)**|Добавляет новую строку в матрицу.|`rowData` - массив данных для новой строки|Модифицированный объект `obj`|
|**getRow(obj, rowIndex)**|Возвращает данные строки по индексу.|`rowIndex` - индекс строки|Массив данных строки|
|**getElement(obj, rowIndex, colIndex)**|Возвращает элемент матрицы по индексам строки и столбца.|`rowIndex` - индекс строки  <br>`colIndex` - индекс столбца|Значение элемента|
|**setElement(obj, rowIndex, colIndex, value)**|Устанавливает новое значение для элемента матрицы.|`rowIndex` - индекс строки  <br>`colIndex` - индекс столбца  <br>`value` - новое значение|Модифицированный объект `obj`|
|**rowCount(obj)**|Возвращает количество строк в матрице.|Нет|Количество строк (double)|
|**rowLength(obj, rowIndex)**|Возвращает длину указанной строки.|`rowIndex` - индекс строки|Длина строки (double)|
|**display(obj)**|Выводит содержимое матрицы в консоль в удобочитаемом виде.|Нет|Нет (вывод в консоль)|
|**toCell(obj)**|Преобразует матрицу в cell-массив, где каждая ячейка содержит данные одной строки.|Нет|cell-массив|